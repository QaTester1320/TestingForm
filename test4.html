<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA & Dev Project Portal</title>
    <style>
        :root { --primary: #2563eb; --secondary: #64748b; --danger: #dc2626; --bg: #f8fafc; --border: #cbd5e1; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: var(--bg); color: #1e293b; padding: 20px; }
        
        .container { max-width: 1100px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* LOGIN */
        #login-page { position: fixed; inset: 0; background: #fff; display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .login-box { width: 350px; padding: 30px; border: 1px solid var(--border); border-radius: 8px; text-align: center; }
        
        /* HEADER & NAVIGATION */
        header { padding: 15px 25px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .tabs { display: flex; background: #f1f5f9; padding: 5px; border-bottom: 1px solid #e2e8f0; }
        .tab-btn { padding: 10px 20px; border: none; background: transparent; cursor: pointer; font-weight: 600; color: var(--secondary); border-radius: 6px; }
        .tab-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .form-container { padding: 25px; }
        .form-section { border: 1px solid #e2e8f0; padding: 20px; border-radius: 8px; margin-bottom: 20px; position: relative; }
        .section-label { position: absolute; top: -12px; left: 15px; background: white; padding: 0 10px; font-size: 12px; font-weight: bold; color: var(--primary); text-transform: uppercase; }

        /* GRID */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 5px; font-size: 14px; }
        
        .type-selector { background: #eff6ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #bfdbfe; }
        .hidden { display: none !important; }

        /* CHECKBOX GROUPS */
        .check-grid { display: flex; flex-wrap: wrap; gap: 12px; margin: 10px 0; }
        .check-item { display: flex; align-items: center; gap: 6px; font-size: 13px; }

        /* READ ONLY VIEW OVERRIDE */
        .view-only input, .view-only select, .view-only textarea, .view-only input[type="checkbox"], .view-only input[type="radio"] { 
            background-color: #f1f5f9 !important; pointer-events: none !important; border-color: #cbd5e1 !important; opacity: 0.8;
        }

        /* TRACKING TABLE */
        .table-area { padding: 25px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { text-align: left; padding: 12px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; font-size: 12px; color: var(--secondary); }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .btn-sm { background: none; border: none; font-weight: bold; cursor: pointer; text-decoration: underline; margin-right: 10px; }
        .badge { padding: 3px 7px; border-radius: 4px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div id="login-page">
    <div class="login-box">
        <h2>Portal Login</h2>
        <input type="text" id="email" placeholder="Email (qa@test.com / dev@test.com)" style="margin: 15px 0;">
        <input type="password" id="pass" value="123" style="margin-bottom: 20px;">
        <button onclick="login()" style="width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:5px; font-weight:bold; cursor:pointer;">Sign In</button>
    </div>
</div>

<div class="container hidden" id="main-app">
    <header>
        <div><strong>Project Portal</strong> | <span id="displayRole" style="color:var(--primary)"></span></div>
        <button onclick="logout()" style="color:var(--danger); border:none; background:none; font-weight:bold; cursor:pointer;">Logout</button>
    </header>

    <div class="tabs">
        <button class="tab-btn active" id="tab-form" onclick="switchTab('form')">New Submission</button>
        <button class="tab-btn" id="tab-track" onclick="switchTab('track')">Tracking Board</button>
    </div>

    <div id="form-view" class="form-container">
        <div class="type-selector" id="mode-selector-container">
            <label>Select Form Action:</label>
            <select id="formMode" onchange="toggleFormFields()">
                <option value="intake">Submit New Request (Full Form)</option>
                <option value="bug">Check Only One Issue/Bug</option>
                <option value="status">Project Update Status Form</option>
            </select>
        </div>

        <form id="qaForm">
            <input type="hidden" id="editId">
            <input type="hidden" id="currentType" value="intake">

            <div class="grid">
                <div><label>Project Name *</label><input type="text" id="p_name" required></div>
                <div><label>Developer Name *</label><input type="text" id="d_name" required></div>
                <div id="tl_wrapper"><label>Team Leader Name *</label><input type="text" id="tl_name"></div>
            </div>

            <div id="testingFields">
                <div style="background:#fffbeb; padding:10px; font-size:12px; border-left:4px solid #f59e0b; margin-bottom:15px;">
                    <strong>Note:</strong> Smoke testing is for general health. Sanity is for specific fixes.
                </div>
                <div class="grid">
                    <div><label>Priority</label><select id="prio"><option>Low</option><option selected>Medium</option><option>High</option></select></div>
                    <div><label>Hours Approx</label><select id="hrs"><option value="1">1 Hour</option><option value="4">4 Hours</option><option value="8">8 Hours</option></select></div>
                </div>

                <div class="form-section">
                    <span class="section-label">Testing Types</span>
                    <div class="check-grid">
                        <label class="check-item"><input type="checkbox" class="t-type" value="Functional"> Functional</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Responsive"> Responsive</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Smoke"> Smoke</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Sanity"> Sanity</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Cross Browser"> Cross Browser</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Performance"> Performance</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Accessibility"> Accessibility</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Deep Testing"> Full Deep Testing</label>
                    </div>
                </div>

                <div class="form-section">
                    <span class="section-label">Environment & Links</span>
                    <div class="grid">
                        <input type="text" id="u_stg" placeholder="Staging URL">
                        <input type="text" id="u_live" placeholder="Live URL">
                        <input type="text" id="u_fig" placeholder="Figma/Ref URL">
                    </div>
                </div>

                <div class="form-section">
                    <span class="section-label">Browsers & OS</span>
                    <div class="check-grid">
                        <label class="check-item"><input type="checkbox" class="b-type" value="Chrome"> Chrome</label>
                        <label class="check-item"><input type="checkbox" class="b-type" value="Safari"> Safari</label>
                        <label class="check-item"><input type="checkbox" class="b-type" value="Edge"> Edge</label>
                        <label class="check-item"><input type="checkbox" class="b-type" value="Firefox"> Firefox</label>
                    </div>
                    <div style="margin-top:10px;"><label>macOS Required?</label><select id="mac_req" style="width:100px;"><option>No</option><option>Yes</option></select></div>
                </div>

                <div class="form-section">
                    <span class="section-label">Regression</span>
                    <div class="check-grid">
                        <label class="check-item"><input type="radio" name="reg" value="None" checked> None</label>
                        <label class="check-item"><input type="radio" name="reg" value="Partial"> Partial</label>
                        <label class="check-item"><input type="radio" name="reg" value="Full"> Full</label>
                    </div>
                </div>
                <label>Test Scenarios / Instructions</label>
                <textarea id="scenarios" rows="3" style="margin-bottom:15px;"></textarea>
            </div>

            <div id="statusFields" class="hidden">
                <div class="grid">
                    <div><label>WTD Project URL</label><input type="url" id="st_w_proj"></div>
                    <div><label>WTD Task URL</label><input type="url" id="st_w_task"></div>
                    <div><label>Comment No.</label><input type="text" id="st_comm"></div>
                </div>
                <div class="grid">
                    <div><label>Ref Names</label><input type="text" id="st_refs"></div>
                    <div><label>Modules Completed</label>
                        <select id="st_mods">
                            <option value="1">1 Module</option><option value="2">2</option><option value="3">3</option>
                            <option value="5">5</option><option value="10">10 Modules (Completed)</option>
                        </select>
                    </div>
                    <div><label>Attachment Link</label><input type="text" id="st_file"></div>
                </div>
                <div><label>Description Box</label><textarea id="st_desc" rows="3"></textarea></div>
                <div class="grid" style="margin-top:15px;">
                    <div><label>Need to Discuss?</label><select id="st_disc"><option>No</option><option>Yes - Request Sync</option></select></div>
                    <div style="grid-column: span 2;"><label>Other Info</label><input type="text" id="st_other"></div>
                </div>
            </div>

            <div style="margin-top:20px;">
                <button type="submit" id="submitBtn" style="padding:12px 30px; background:var(--primary); color:white; border:none; border-radius:5px; font-weight:bold; cursor:pointer;">Submit to QA</button>
                <button type="button" id="closeBtn" class="hidden" onclick="switchTab('track')" style="padding:12px 30px; background:var(--secondary); color:white; border:none; border-radius:5px; font-weight:bold; cursor:pointer;">Close View</button>
            </div>
        </form>
    </div>

    <div id="track-view" class="table-area hidden">
        <table>
            <thead>
                <tr><th>Form Type</th><th>Project / Dev</th><th>QA Status</th><th>Created</th><th>Actions</th></tr>
            </thead>
            <tbody id="trackBody"></tbody>
        </table>
    </div>
</div>

<script>
    let user = JSON.parse(localStorage.getItem('portal_user')) || null;
    const dbKey = 'portal_db_v10';

    function login() {
        const email = document.getElementById('email').value;
        if(email.includes('qa')) user = { email, role: 'qa' };
        else if(email.includes('dev')) user = { email, role: 'dev' };
        if(user) {
            localStorage.setItem('portal_user', JSON.stringify(user));
            location.reload();
        }
    }
    function logout() { localStorage.removeItem('portal_user'); location.reload(); }

    function init() {
        if(!user) return;
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        document.getElementById('displayRole').innerText = user.role.toUpperCase();
        if(user.role === 'qa') { 
            document.getElementById('tab-form').classList.add('hidden'); 
            switchTab('track'); 
        } else {
            switchTab('form');
        }
    }

    function toggleFormFields() {
        const mode = document.getElementById('formMode').value;
        document.getElementById('currentType').value = mode;
        const isStatus = mode === 'status';
        
        document.getElementById('statusFields').classList.toggle('hidden', !isStatus);
        document.getElementById('testingFields').classList.toggle('hidden', isStatus);
        document.getElementById('tl_wrapper').classList.toggle('hidden', isStatus);
        document.getElementById('tl_name').required = !isStatus;
    }

    function switchTab(tab) {
        document.getElementById('form-view').classList.toggle('hidden', tab !== 'form');
        document.getElementById('track-view').classList.toggle('hidden', tab !== 'track');
        document.getElementById('tab-form').classList.toggle('active', tab === 'form');
        document.getElementById('tab-track').classList.toggle('active', tab === 'track');
        if(tab === 'track') renderTable();
        else resetForm();
    }

    function resetForm() {
        const f = document.getElementById('qaForm');
        f.reset();
        f.classList.remove('view-only');
        document.getElementById('mode-selector-container').classList.remove('hidden');
        document.getElementById('editId').value = '';
        document.getElementById('submitBtn').classList.remove('hidden');
        document.getElementById('submitBtn').innerText = "Submit to QA";
        document.getElementById('closeBtn').classList.add('hidden');
        toggleFormFields();
    }

    document.getElementById('qaForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const db = JSON.parse(localStorage.getItem(dbKey) || '[]');
        const editId = document.getElementById('editId').value;
        
        const entry = {
            id: editId || Date.now(),
            owner: user.email,
            type: document.getElementById('currentType').value,
            proj: document.getElementById('p_name').value,
            dev: document.getElementById('d_name').value,
            status: 'pending',
            date: editId ? db.find(x => x.id == editId).date : new Date().toLocaleString(),
            data: {
                tl: document.getElementById('tl_name').value,
                scen: document.getElementById('scenarios').value,
                // Status specific
                st_wp: document.getElementById('st_w_proj').value,
                st_wt: document.getElementById('st_w_task').value,
                st_md: document.getElementById('st_mods').value,
                st_ds: document.getElementById('st_desc').value
            }
        };

        if(editId) {
            const idx = db.findIndex(x => x.id == editId);
            db[idx] = entry;
        } else db.unshift(entry);

        localStorage.setItem(dbKey, JSON.stringify(db));
        alert("Saved successfully!");
        switchTab('track');
    });

    function renderTable() {
        const db = JSON.parse(localStorage.getItem(dbKey) || '[]');
        const body = document.getElementById('trackBody');
        body.innerHTML = '';
        
        const filtered = user.role === 'qa' ? db : db.filter(x => x.owner === user.email);

        filtered.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><span class="badge" style="background:#e0f2fe; color:#0369a1">${item.type.toUpperCase()}</span></td>
                <td><strong>${item.proj}</strong><br><small>${item.dev}</small></td>
                <td>
                    <select onchange="updateStatus(${item.id}, this.value)" ${user.role !== 'qa' ? 'disabled' : ''}>
                        <option value="pending" ${item.status==='pending'?'selected':''}>Pending</option>
                        <option value="verified" ${item.status==='verified'?'selected':''}>Verified âœ…</option>
                    </select>
                </td>
                <td><small>${item.date}</small></td>
                <td>
                    <button class="btn-sm" style="color:blue" onclick="viewEntry(${item.id}, 'view')">View</button>
                    ${user.role === 'dev' ? `
                        <button class="btn-sm" style="color:green" onclick="viewEntry(${item.id}, 'edit')">Edit</button>
                        <button class="btn-sm" style="color:red" onclick="deleteEntry(${item.id})">Delete</button>
                    ` : ''}
                </td>
            `;
            body.appendChild(tr);
        });
    }

    function viewEntry(id, mode) {
        const item = JSON.parse(localStorage.getItem(dbKey)).find(x => x.id == id);
        document.getElementById('editId').value = mode === 'view' ? '' : item.id;
        document.getElementById('formMode').value = item.type;
        toggleFormFields();

        // Populate
        document.getElementById('p_name').value = item.proj;
        document.getElementById('d_name').value = item.dev;
        document.getElementById('tl_name').value = item.data.tl;
        document.getElementById('scenarios').value = item.data.scen;
        document.getElementById('st_w_proj').value = item.data.st_wp || '';
        document.getElementById('st_mods').value = item.data.st_md || '1';
        document.getElementById('st_desc').value = item.data.st_ds || '';

        const form = document.getElementById('qaForm');
        document.getElementById('mode-selector-container').classList.add('hidden');

        if(mode === 'view') {
            form.classList.add('view-only');
            document.getElementById('submitBtn').classList.add('hidden');
            document.getElementById('closeBtn').classList.remove('hidden');
        } else {
            form.classList.remove('view-only');
            document.getElementById('submitBtn').classList.remove('hidden');
            document.getElementById('submitBtn').innerText = "Update Record";
            document.getElementById('closeBtn').classList.add('hidden');
        }
        document.getElementById('form-view').classList.remove('hidden');
        document.getElementById('track-view').classList.add('hidden');
    }

    function deleteEntry(id) {
        if(!confirm("Delete this entry?")) return;
        let db = JSON.parse(localStorage.getItem(dbKey));
        db = db.filter(x => x.id != id);
        localStorage.setItem(dbKey, JSON.stringify(db));
        renderTable();
    }

    function updateStatus(id, stat) {
        const db = JSON.parse(localStorage.getItem(dbKey));
        db.find(x => x.id == id).status = stat;
        localStorage.setItem(dbKey, JSON.stringify(db));
    }

    init();
</script>
</body>
</html>
