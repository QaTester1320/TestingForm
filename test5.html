<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA & Dev Project Portal</title>
    <style>
        :root { --primary: #2563eb; --secondary: #64748b; --danger: #dc2626; --bg: #f8fafc; --border: #cbd5e1; --success: #16a34a; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; }
        body { background: var(--bg); color: #1e293b; padding: 10px; }
        
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* LOGIN */
        #login-page { position: fixed; inset: 0; background: #fff; display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px; }
        .login-card { width: 100%; max-width: 400px; padding: 30px; border: 1px solid var(--border); border-radius: 12px; text-align: center; }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 6px; }

        /* HEADER & TABS */
        header { padding: 15px 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .nav-tabs { display: flex; background: #f1f5f9; padding: 6px; gap: 6px; border-bottom: 1px solid #e2e8f0; overflow-x: auto; }
        .tab-btn { padding: 10px 18px; border: none; background: transparent; cursor: pointer; font-weight: 600; border-radius: 8px; color: var(--secondary); white-space: nowrap; }
        .tab-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .content-area { padding: 20px; }
        .form-section { border: 1px solid #e2e8f0; padding: 20px; border-radius: 10px; margin-bottom: 20px; position: relative; background: #fff; }
        .section-label { font-size: 11px; font-weight: 800; text-transform: uppercase; color: var(--primary); margin-bottom: 15px; display: block; border-bottom: 1px solid #f1f5f9; padding-bottom: 5px; }

        /* GRID SYSTEM - RESPONSIVE */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; }
        input, select, textarea { width: 100%; padding: 11px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; transition: border 0.2s; }
        input:focus { border-color: var(--primary); outline: none; }
        
        .selector-box { background: #eff6ff; padding: 15px; border-radius: 10px; border: 1px solid #bfdbfe; margin-bottom: 20px; }
        .hidden { display: none !important; }

        /* CHECKBOX/RADIO GROUPS */
        .check-grid { display: flex; flex-wrap: wrap; gap: 12px; padding: 5px 0; }
        .check-item { display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; cursor: pointer; }

        /* READ ONLY OVERRIDE */
        .view-mode-only input, .view-mode-only select, .view-mode-only textarea, .view-mode-only input[type="checkbox"], .view-mode-only input[type="radio"] { 
            background: #f1f5f9 !important; border-color: #cbd5e1 !important; color: #64748b !important; cursor: not-allowed;
        }

        /* TABLE */
        .table-wrap { width: 100%; overflow-x: auto; border: 1px solid #e2e8f0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th { text-align: left; padding: 14px; background: #f8fafc; border-bottom: 2px solid #edf2f7; font-size: 12px; color: var(--secondary); text-transform: uppercase; }
        td { padding: 14px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .btn-link { background: none; border: none; cursor: pointer; font-weight: bold; margin-right: 12px; text-decoration: underline; font-size: 12px; }
        
        @media (max-width: 600px) {
            .grid { grid-template-columns: 1fr; }
            header { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>

<div id="login-page">
    <div class="login-card">
        <h2 style="margin-bottom:20px;">QA Portal Access</h2>
        <input type="text" id="email" placeholder="Email (qa@test.com / dev@test.com)">
        <input type="password" id="pass" value="123">
        <button onclick="login()" style="width:100%; padding:14px; background:var(--primary); color:white; border:none; border-radius:6px; font-weight:bold; cursor:pointer;">Sign In</button>
        <p style="font-size:11px; color:var(--secondary); margin-top:15px;">QA: qa@test.com | Dev: dev@test.com | Pass: 123</p>
    </div>
</div>

<div class="container hidden" id="main-app">
    <header>
        <div><strong>QA & Dev Project Portal</strong> | <span id="displayRole" style="color:var(--primary)"></span></div>
        <button onclick="logout()" style="color:var(--danger); border:none; background:none; font-weight:bold; cursor:pointer;">Sign Out</button>
    </header>

    <div class="nav-tabs">
        <button class="tab-btn active" id="tab-form" onclick="switchTab('form')">New Submission</button>
        <button class="tab-btn" id="tab-track" onclick="switchTab('track')">Tracking Board</button>
    </div>

    <div id="form-view" class="content-area">
        <div class="selector-box" id="selector-container">
            <label>Select Form Action Type:</label>
            <select id="formMode" onchange="toggleFormLayout()">
                <option value="intake">Submit New Request (Full Form)</option>
                <option value="bug">Check Only One Issue/Bug</option>
                <option value="status">Project Update Status Form</option>
            </select>
        </div>

        <form id="masterForm">
            <input type="hidden" id="editId">
            <input type="hidden" id="activeType" value="intake">

            <div class="grid">
                <div><label>Project Name *</label><input type="text" id="p_name" required></div>
                <div><label>Developer/Designer Name *</label><input type="text" id="d_name" required></div>
                <div id="tl_wrap"><label>Team Leader Name *</label><input type="text" id="tl_name"></div>
            </div>

            <div id="testingFields">
                <div style="background:#fffbeb; border-left:4px solid #f59e0b; padding:12px; margin-bottom:20px; font-size:13px;">
                    <strong>Note:</strong> Smoke testing ensures core functions work. Sanity testing targets specific bug fixes.
                </div>
                <div class="grid">
                    <div><label>Priority</label><select id="prio"><option>Low</option><option selected>Medium</option><option>High</option><option>Urgent</option></select></div>
                    <div><label>Estimate Hours</label><select id="hrs"><option value="1">1 Hour</option><option value="4">4 Hours</option><option value="8">8 Hours</option></select></div>
                </div>

                <div class="form-section">
                    <span class="section-label">Testing Types Required *</span>
                    <div class="check-grid">
                        <label class="check-item"><input type="checkbox" class="t-type" value="Functional"> Functional</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Responsive"> Responsive</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Cross Browser"> Cross Browser</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Performance"> Performance</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Accessibility"> Accessibility</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Smoke"> Smoke</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Sanity"> Sanity</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Full Deep Testing"> Full Deep Testing</label>
                    </div>
                </div>

                <div class="form-section">
                    <span class="section-label">Environment & URLs</span>
                    <div class="check-grid" style="margin-bottom:15px;">
                        <label class="check-item"><input type="checkbox" class="env" value="Dev"> Dev</label>
                        <label class="check-item"><input type="checkbox" class="env" value="QA"> QA</label>
                        <label class="check-item"><input type="checkbox" class="env" value="Staging"> Staging</label>
                        <label class="check-item"><input type="checkbox" class="env" value="Prod"> Prod</label>
                    </div>
                    <div class="grid">
                        <input type="text" id="u_stg" placeholder="Staging URL">
                        <input type="text" id="u_live" placeholder="Live URL">
                        <input type="text" id="u_fig" placeholder="Reference (Figma/Doc)">
                    </div>
                    <div class="grid" style="margin-top:10px;">
                        <input type="text" id="u_wtd" placeholder="WTD project task URL" style="grid-column: span 2;">
                        <input type="text" id="u_ref_task" placeholder="Ref URL for this Task">
                    </div>
                </div>

                <div class="form-section">
                    <span class="section-label">Browsers & OS</span>
                    <div class="check-grid">
                        <label class="check-item"><input type="checkbox" class="browser" value="Chrome"> Chrome</label>
                        <label class="check-item"><input type="checkbox" class="browser" value="Safari"> Safari</label>
                        <label class="check-item"><input type="checkbox" class="browser" value="Edge"> Edge</label>
                        <label class="check-item"><input type="checkbox" class="browser" value="Firefox"> Firefox</label>
                        <label class="check-item"><input type="checkbox" class="browser" value="Opera"> Opera</label>
                        <label class="check-item"><input type="checkbox" class="browser" value="Samsung Galaxy"> Samsung Galaxy</label>
                    </div>
                    <div style="margin-top:15px;">
                        <label>macOS Required?</label>
                        <select id="mac_req" style="width:120px;"><option>No</option><option>Yes</option></select>
                    </div>
                </div>

                <div class="form-section">
                    <span class="section-label">Regression Testing</span>
                    <div class="check-grid">
                        <label class="check-item"><input type="radio" name="reg" value="None" checked> None Required</label>
                        <label class="check-item"><input type="radio" name="reg" value="Partial"> Partial Regression</label>
                        <label class="check-item"><input type="radio" name="reg" value="Full"> Full Regression</label>
                    </div>
                    <textarea id="reg_impact" placeholder="List modules that might be affected..." rows="2" style="margin-top:10px;"></textarea>
                </div>

                <div class="form-section">
                    <span class="section-label">BrowserStack / Devices Needed</span>
                    <div class="grid">
                        <div><label>iOS Qty</label><input type="number" id="bs_ios" value="0"></div>
                        <div><label>Android Qty</label><input type="number" id="bs_and" value="0"></div>
                        <div><label>iPad Qty</label><input type="number" id="bs_ipad" value="0"></div>
                    </div>
                </div>
                <label>Test Scenarios / Instructions *</label>
                <textarea id="scenarios" rows="4" style="margin-bottom:15px;"></textarea>
            </div>

            <div id="statusFields" class="hidden">
                <div class="grid">
                    <div><label>WTD Project URL</label><input type="url" id="st_w_proj"></div>
                    <div><label>WTD Task URL</label><input type="url" id="st_w_task"></div>
                    <div><label>Comment No.</label><input type="text" id="st_comm"></div>
                </div>
                <div class="grid">
                    <div><label>Ref Names</label><input type="text" id="st_refs"></div>
                    <div><label>Modules Completed</label>
                        <select id="st_mods">
                            <option value="1">1 Module</option><option value="2">2</option><option value="3">3</option>
                            <option value="5">5</option><option value="8">8</option><option value="10">10 (Completed)</option>
                        </select>
                    </div>
                    <div><label>Attachment Link</label><input type="text" id="st_attach"></div>
                </div>
                <div><label>Description Box</label><textarea id="st_desc" rows="3"></textarea></div>
                <div class="grid" style="margin-top:15px;">
                    <div><label>Need to Discuss?</label><select id="st_disc"><option>No</option><option>Yes - Sync Required</option></select></div>
                    <div style="grid-column: span 2;"><label>Other Info</label><input type="text" id="st_other_info"></div>
                </div>
            </div>

            <div id="commonBottom" style="margin-top:10px;">
                <label>Other field for other info</label>
                <textarea id="global_other" rows="2"></textarea>
            </div>

            <div style="margin-top:25px; display:flex; gap:15px;">
                <button type="submit" id="submitBtn" style="padding:14px 35px; background:var(--primary); color:white; border:none; border-radius:6px; font-weight:bold; cursor:pointer;">ðŸš€ Submit Request to QA</button>
                <button type="button" id="closeBtn" class="hidden" onclick="switchTab('track')" style="padding:14px 35px; background:var(--secondary); color:white; border:none; border-radius:6px; font-weight:bold; cursor:pointer;">Close View</button>
            </div>
        </form>
    </div>

    <div id="track-view" class="content-area hidden">
        <div class="table-wrap">
            <table>
                <thead>
                    <tr><th>Type</th><th>Project & Developer</th><th>QA Status</th><th>Created</th><th>Actions</th></tr>
                </thead>
                <tbody id="trackBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let user = JSON.parse(localStorage.getItem('portal_user_v5')) || null;
    const dbKey = 'portal_database_final_v5';

    function login() {
        const email = document.getElementById('email').value.toLowerCase();
        if(email.includes('qa')) user = { email, role: 'qa' };
        else if(email.includes('dev')) user = { email, role: 'dev' };
        if(user) {
            localStorage.setItem('portal_user_v5', JSON.stringify(user));
            location.reload();
        }
    }
    function logout() { localStorage.removeItem('portal_user_v5'); location.reload(); }

    function init() {
        if(!user) return;
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        document.getElementById('displayRole').innerText = user.role.toUpperCase();
        if(user.role === 'qa') { document.getElementById('tab-form').classList.add('hidden'); switchTab('track'); }
        else switchTab('form');
    }

    function toggleFormLayout() {
        const mode = document.getElementById('formMode').value;
        document.getElementById('activeType').value = mode;
        const isStatus = mode === 'status';
        
        document.getElementById('statusFields').classList.toggle('hidden', !isStatus);
        document.getElementById('testingFields').classList.toggle('hidden', isStatus);
        document.getElementById('tl_wrap').classList.toggle('hidden', isStatus);
        document.getElementById('tl_name').required = !isStatus;
    }

    function switchTab(tab) {
        document.getElementById('form-view').classList.toggle('hidden', tab !== 'form');
        document.getElementById('track-view').classList.toggle('hidden', tab !== 'track');
        document.getElementById('tab-form').classList.toggle('active', tab === 'form');
        document.getElementById('tab-track').classList.toggle('active', tab === 'track');
        if(tab === 'track') renderTable(); else resetForm();
    }

    function resetForm() {
        const f = document.getElementById('masterForm');
        f.reset();
        f.classList.remove('view-mode-only');
        f.querySelectorAll('input, select, textarea').forEach(el => el.disabled = false);
        document.getElementById('selector-container').classList.remove('hidden');
        document.getElementById('editId').value = '';
        document.getElementById('submitBtn').classList.remove('hidden');
        document.getElementById('submitBtn').innerText = "ðŸš€ Submit Request to QA";
        document.getElementById('closeBtn').classList.add('hidden');
        toggleFormLayout();
    }

    document.getElementById('masterForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const db = JSON.parse(localStorage.getItem(dbKey) || '[]');
        const editId = document.getElementById('editId').value;
        
        const entry = {
            id: editId || Date.now(),
            user: user.email,
            type: document.getElementById('activeType').value,
            proj: document.getElementById('p_name').value,
            dev: document.getElementById('d_name').value,
            status: 'pending',
            date: editId ? db.find(x => x.id == editId).date : new Date().toLocaleString(),
            data: {
                tl: document.getElementById('tl_name').value,
                prio: document.getElementById('prio').value,
                hrs: document.getElementById('hrs').value,
                types: Array.from(document.querySelectorAll('.t-type:checked')).map(c => c.value),
                envs: Array.from(document.querySelectorAll('.env:checked')).map(c => c.value),
                browsers: Array.from(document.querySelectorAll('.browser:checked')).map(c => c.value),
                urls: [document.getElementById('u_stg').value, document.getElementById('u_live').value, document.getElementById('u_fig').value, document.getElementById('u_wtd').value, document.getElementById('u_ref_task').value],
                reg: document.querySelector('input[name="reg"]:checked').value,
                impact: document.getElementById('reg_impact').value,
                bs: [document.getElementById('bs_ios').value, document.getElementById('bs_and').value, document.getElementById('bs_ipad').value, document.getElementById('mac_req').value],
                scenarios: document.getElementById('scenarios').value,
                // Status fields
                st_wp: document.getElementById('st_w_proj').value, st_wt: document.getElementById('st_w_task').value, st_cm: document.getElementById('st_comm').value,
                st_rf: document.getElementById('st_refs').value, st_md: document.getElementById('st_mods').value, st_at: document.getElementById('st_attach').value,
                st_ds: document.getElementById('st_desc').value, st_di: document.getElementById('st_disc').value, st_ot: document.getElementById('st_other_info').value,
                global_ot: document.getElementById('global_other').value
            }
        };

        if(editId) {
            const idx = db.findIndex(x => x.id == editId);
            db[idx] = entry;
        } else db.unshift(entry);

        localStorage.setItem(dbKey, JSON.stringify(db));
        alert("Entry Saved Successfully!");
        switchTab('track');
    });

    function renderTable() {
        const db = JSON.parse(localStorage.getItem(dbKey) || '[]');
        const body = document.getElementById('trackBody');
        body.innerHTML = '';
        
        const visibleData = user.role === 'qa' ? db : db.filter(x => x.user === user.email);

        visibleData.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><span style="font-weight:bold; color:var(--primary)">${item.type.toUpperCase()}</span></td>
                <td><strong>${item.proj}</strong><br><small>By: ${item.dev}</small></td>
                <td>
                    <select onchange="updateStatus(${item.id}, this.value)" ${user.role !== 'qa' ? 'disabled' : ''}>
                        <option value="pending" ${item.status==='pending'?'selected':''}>Pending</option>
                        <option value="verified" ${item.status==='verified'?'selected':''}>Verified âœ…</option>
                    </select>
                </td>
                <td><small>${item.date}</small></td>
                <td>
                    <button class="btn-link" style="color:blue" onclick="openEntry(${item.id}, 'view')">View</button>
                    ${user.role === 'dev' ? `
                        <button class="btn-link" style="color:green" onclick="openEntry(${item.id}, 'edit')">Edit</button>
                        <button class="btn-link" style="color:red" onclick="deleteEntry(${item.id})">Delete</button>
                    ` : ''}
                </td>
            `;
            body.appendChild(tr);
        });
    }

    function openEntry(id, mode) {
        const item = JSON.parse(localStorage.getItem(dbKey)).find(x => x.id == id);
        document.getElementById('editId').value = mode === 'view' ? '' : item.id;
        document.getElementById('formMode').value = item.type;
        toggleFormLayout();

        // Map values
        document.getElementById('p_name').value = item.proj;
        document.getElementById('d_name').value = item.dev;
        document.getElementById('tl_name').value = item.data.tl;
        document.getElementById('prio').value = item.data.prio;
        document.getElementById('hrs').value = item.data.hrs;
        document.querySelectorAll('.t-type').forEach(c => c.checked = item.data.types.includes(c.value));
        document.querySelectorAll('.env').forEach(c => c.checked = item.data.envs.includes(c.value));
        document.querySelectorAll('.browser').forEach(c => c.checked = item.data.browsers.includes(c.value));
        document.getElementById('u_stg').value = item.data.urls[0];
        document.getElementById('u_live').value = item.data.urls[1];
        document.getElementById('u_fig').value = item.data.urls[2];
        document.getElementById('u_wtd').value = item.data.urls[3];
        document.getElementById('u_ref_task').value = item.data.urls[4];
        document.querySelector(`input[name="reg"][value="${item.data.reg}"]`).checked = true;
        document.getElementById('reg_impact').value = item.data.impact;
        document.getElementById('bs_ios').value = item.data.bs[0];
        document.getElementById('bs_and').value = item.data.bs[1];
        document.getElementById('bs_ipad').value = item.data.bs[2];
        document.getElementById('mac_req').value = item.data.bs[3];
        document.getElementById('scenarios').value = item.data.scenarios;
        // Status fields
        document.getElementById('st_w_proj').value = item.data.st_wp || '';
        document.getElementById('st_w_task').value = item.data.st_wt || '';
        document.getElementById('st_comm').value = item.data.st_cm || '';
        document.getElementById('st_refs').value = item.data.st_rf || '';
        document.getElementById('st_mods').value = item.data.st_md || '1';
        document.getElementById('st_attach').value = item.data.st_at || '';
        document.getElementById('st_desc').value = item.data.st_ds || '';
        document.getElementById('st_disc').value = item.data.st_di || 'No';
        document.getElementById('st_other_info').value = item.data.st_ot || '';
        document.getElementById('global_other').value = item.data.global_ot || '';

        const form = document.getElementById('masterForm');
        document.getElementById('selector-container').classList.add('hidden');

        if(mode === 'view') {
            form.classList.add('view-mode-only');
            form.querySelectorAll('input, select, textarea').forEach(el => el.disabled = true);
            document.getElementById('submitBtn').classList.add('hidden');
            document.getElementById('closeBtn').classList.remove('hidden');
        } else {
            form.classList.remove('view-mode-only');
            form.querySelectorAll('input, select, textarea').forEach(el => el.disabled = false);
            document.getElementById('submitBtn').classList.remove('hidden');
            document.getElementById('submitBtn').innerText = "ðŸ’¾ Update Record";
            document.getElementById('closeBtn').classList.add('hidden');
        }
        document.getElementById('form-view').classList.remove('hidden');
        document.getElementById('track-view').classList.add('hidden');
    }

    function deleteEntry(id) {
        if(!confirm("Are you sure you want to delete this?")) return;
        let db = JSON.parse(localStorage.getItem(dbKey));
        db = db.filter(x => x.id != id);
        localStorage.setItem(dbKey, JSON.stringify(db));
        renderTable();
    }

    function updateStatus(id, val) {
        const db = JSON.parse(localStorage.getItem(dbKey));
        db.find(x => x.id == id).status = val;
        localStorage.setItem(dbKey, JSON.stringify(db));
    }

    init();
</script>
</body>
</html>
