<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise QA Intake Portal</title>
    <style>
        :root { --primary: #2563eb; --secondary: #64748b; --danger: #dc2626; --bg: #f8fafc; --border: #cbd5e1; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #1e293b; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* LOGIN SCREEN (Matching image_c29b48.png) */
        #login-page { position: fixed; inset: 0; background: white; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-card { width: 100%; max-width: 400px; padding: 40px; }
        .login-card h1 { font-size: 24px; text-align: center; margin-bottom: 30px; color: #1e293b; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 14px; }
        .login-input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 16px; outline: none; }
        .login-input:focus { border-color: var(--primary); }
        .btn-signin { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .login-footer { margin-top: 15px; text-align: center; font-size: 12px; color: var(--secondary); }

        /* DASHBOARD */
        header { background: white; padding: 15px 30px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .nav-tabs { display: flex; background: #f1f5f9; padding: 8px; gap: 8px; }
        .tab-btn { padding: 10px 25px; border: none; background: transparent; cursor: pointer; font-weight: bold; border-radius: 8px; color: var(--secondary); }
        .tab-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .content { padding: 30px; }
        .section { border: 1px solid #e2e8f0; padding: 25px; border-radius: 10px; margin-bottom: 25px; }
        .section-title { font-size: 12px; font-weight: 800; text-transform: uppercase; color: var(--primary); margin-bottom: 20px; display: block; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; }

        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 13px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; background: white; }
        
        /* READ ONLY STATE */
        .read-only input, .read-only select, .read-only textarea { 
            background: #f8fafc !important; border-color: #e2e8f0 !important; cursor: not-allowed; pointer-events: none; 
        }

        .check-group { display: flex; flex-wrap: wrap; gap: 15px; padding: 10px 0; }
        .check-item { display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; }
        
        .note { background: #fffbeb; border-left: 4px solid #f59e0b; padding: 15px; margin-bottom: 25px; font-size: 13px; color: #92400e; }
        .hidden { display: none !important; }

        /* TABLE */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; background: #f8fafc; border-bottom: 2px solid #edf2f7; font-size: 12px; text-transform: uppercase; color: var(--secondary); }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
        .action-btn { background: none; border: none; cursor: pointer; font-weight: bold; margin-right: 10px; font-size: 13px; }
    </style>
</head>
<body>

<div id="login-page">
    <div class="login-card">
        <h1>QA Portal Access</h1>
        <div class="input-group">
            <label>Email</label>
            <input type="text" id="logEmail" class="login-input" placeholder="e.g. qa@test.com">
        </div>
        <div class="input-group">
            <label>Password</label>
            <input type="password" id="logPass" class="login-input" value="123">
        </div>
        <button class="btn-signin" onclick="handleLogin()">Sign In</button>
        <div class="login-footer">
            QA: qa@test.com | Dev: dev@test.com | Pass: 123
        </div>
    </div>
</div>

<div class="container hidden" id="app">
    <header>
        <div><strong>QA Portal</strong> | <span id="userTag" style="color:var(--primary)"></span></div>
        <button onclick="handleLogout()" style="background:none; border:none; color:var(--danger); cursor:pointer; font-weight:bold;">Sign Out</button>
    </header>

    <div class="nav-tabs">
        <button class="tab-btn active" id="btn-form-tab" onclick="setTab('form')">New Request</button>
        <button class="tab-btn" onclick="setTab('track')">Tracking Board</button>
    </div>

    <div class="content">
        <div id="view-form">
            <div id="note-box" class="note">
                <strong>Note:</strong> Smoke testing covers the entire system to ensure acute functionalities work fine. Sanity testing checks specific components to verify bug fixes.
            </div>

            <form id="qaFormMain">
                <input type="hidden" id="editId">
                <div class="grid-3" style="margin-bottom: 20px;">
                    <div><label>Developer/Designer *</label><input type="text" id="ownerField" required></div>
                    <div><label>Project Name *</label><input type="text" id="projName" required></div>
                    <div>
                        <label>Priority</label>
                        <select id="prioField">
                            <option>Low</option><option selected>Medium</option><option>High</option><option>Urgent</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <span class="section-title">Testing Type *</span>
                    <div class="check-group">
                        <label class="check-item"><input type="checkbox" class="t-type" value="Functional"> Functional</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Responsive"> Responsive</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Cross Browser"> Cross Browser</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Performance"> Performance</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Accessibility"> Accessibility</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Smoke"> Smoke</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Sanity"> Sanity</label>
                        <label class="check-item"><input type="checkbox" class="t-type" value="Full Deep"> Full Deep Testing</label>
                    </div>
                </div>

                <div class="section">
                    <span class="section-title">ENVIRONMENT & URLs</span>
                    <div class="check-group">
                        <label class="check-item"><input type="checkbox" class="env-c" value="Dev"> Dev</label>
                        <label class="check-item"><input type="checkbox" class="env-c" value="QA"> QA</label>
                        <label class="check-item"><input type="checkbox" class="env-c" value="Staging"> Staging</label>
                        <label class="check-item"><input type="checkbox" class="env-c" value="Prod"> Prod</label>
                    </div>
                    <div class="grid-3" style="margin-top:15px;">
                        <input type="text" id="url_stg" placeholder="Staging URL">
                        <input type="text" id="url_live" placeholder="Live URL">
                        <input type="text" id="url_figma" placeholder="Reference (Figma/Doc)">
                    </div>
                    <div class="grid-3" style="margin-top:15px;">
                        <input type="text" id="url_wtd" placeholder="WTD project task URL">
                        <input type="text" id="url_task_ref" placeholder="Ref URL of this task">
                        <div><label>Hours Required (1-24)</label><input type="number" id="hrsField" min="1" max="24" value="1"></div>
                    </div>
                </div>

                <div class="section">
                    <span class="section-title">Regression Type</span>
                    <div class="check-group">
                        <label class="check-item"><input type="radio" name="regR" value="Full"> Full</label>
                        <label class="check-item"><input type="radio" name="regR" value="Partial"> Partial</label>
                        <label class="check-item"><input type="radio" name="regR" value="None" checked> None Required</label>
                    </div>
                    <div style="margin-top:15px;">
                        <label>Impacted modules (if any):</label>
                        <textarea id="impactField" rows="2" placeholder="e.g. Checkout, User Profile..."></textarea>
                    </div>
                </div>

                <div class="section">
                    <span class="section-title">BROWSERSTACK / DEVICES NEEDED</span>
                    <div class="grid-4">
                        <div><label>iOS Qty</label><input type="number" id="bs_ios" value="0"></div>
                        <div><label>Android Qty</label><input type="number" id="bs_and" value="0"></div>
                        <div><label>Android Tablet Qty</label><input type="number" id="bs_tab" value="0"></div>
                        <div><label>iPad Qty</label><input type="number" id="bs_ipad" value="0"></div>
                    </div>
                    <div style="margin-top:15px; width: 200px;">
                        <label>macOS Required?</label>
                        <select id="bs_mac"><option>No</option><option>Yes</option></select>
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <label>What scenarios should be tested? *</label>
                    <textarea id="scenarioField" rows="3" required></textarea>
                </div>

                <button type="submit" id="mainSubmitBtn" class="btn-signin">ðŸ“¤ Submit Request to QA</button>
                <button type="button" id="closeViewBtn" class="btn-signin hidden" onclick="setTab('track')" style="background:var(--secondary)">Back to Tracking</button>
            </form>
        </div>

        <div id="view-track" class="hidden">
            <table>
                <thead>
                    <tr>
                        <th>Project / Developer</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Logs</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="trackBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let session = JSON.parse(localStorage.getItem('qa_user_session')) || null;
    const users = { "qa@test.com": "qa", "dev@test.com": "dev" };

    function handleLogin() {
        const email = document.getElementById('logEmail').value;
        if(users[email]) {
            session = { email, role: users[email] };
            localStorage.setItem('qa_user_session', JSON.stringify(session));
            location.reload();
        } else alert("Unknown User");
    }

    function handleLogout() { localStorage.removeItem('qa_user_session'); location.reload(); }

    function init() {
        if(!session) return;
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        document.getElementById('userTag').innerText = session.role.toUpperCase();
        
        if(session.role === 'qa') {
            document.getElementById('btn-form-tab').classList.add('hidden');
            setTab('track');
        } else { setTab('form'); }
    }

    function setTab(t) {
        const isForm = (t === 'form');
        document.getElementById('view-form').classList.toggle('hidden', !isForm);
        document.getElementById('view-track').classList.toggle('hidden', isForm);
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(t)));
        
        // Reset read-only state when moving to form
        const f = document.getElementById('qaFormMain');
        f.classList.remove('read-only');
        f.querySelectorAll('input, select, textarea').forEach(i => i.disabled = false);
        document.getElementById('mainSubmitBtn').classList.remove('hidden');
        document.getElementById('closeViewBtn').classList.add('hidden');
        
        if(t === 'track') renderTable();
    }

    document.getElementById('qaFormMain').addEventListener('submit', function(e) {
        e.preventDefault();
        const db = JSON.parse(localStorage.getItem('qa_db_main') || '[]');
        const editId = document.getElementById('editId').value;
        const now = new Date().toLocaleString();

        const data = {
            id: editId || Date.now(),
            ownerEmail: session.email,
            ownerName: document.getElementById('ownerField').value,
            project: document.getElementById('projName').value,
            priority: document.getElementById('prioField').value,
            wtd: document.getElementById('url_wtd').value,
            created: editId ? db.find(x => x.id == editId).created : now,
            lastEdit: editId ? now : null,
            status: 'pending',
            // Save all fields for full persistence
            raw: {
                types: Array.from(document.querySelectorAll('.t-type:checked')).map(c => c.value),
                envs: Array.from(document.querySelectorAll('.env-c:checked')).map(c => c.value),
                urls: [document.getElementById('url_stg').value, document.getElementById('url_live').value, document.getElementById('url_figma').value],
                reg: document.querySelector('input[name="regR"]:checked').value,
                impact: document.getElementById('impactField').value,
                bs: [document.getElementById('bs_ios').value, document.getElementById('bs_and').value, document.getElementById('bs_tab').value, document.getElementById('bs_ipad').value, document.getElementById('bs_mac').value],
                scenarios: document.getElementById('scenarioField').value,
                hours: document.getElementById('hrsField').value,
                taskRef: document.getElementById('url_task_ref').value
            }
        };

        if(editId) { db[db.findIndex(x => x.id == editId)] = data; }
        else { db.unshift(data); }

        localStorage.setItem('qa_db_main', JSON.stringify(db));
        this.reset();
        document.getElementById('editId').value = '';
        setTab('track');
    });

    function renderTable() {
        const db = JSON.parse(localStorage.getItem('qa_db_main') || '[]');
        const body = document.getElementById('trackBody');
        body.innerHTML = '';
        const list = session.role === 'qa' ? db : db.filter(x => x.ownerEmail === session.email);

        list.forEach(it => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><strong>${it.project}</strong><br><small>${it.ownerName}</small></td>
                <td>${it.priority}</td>
                <td>
                    <select onchange="updStat(${it.id}, this.value)" ${session.role !== 'qa' ? 'disabled' : ''}>
                        <option value="pending" ${it.status === 'pending' ? 'selected' : ''}>Pending</option>
                        <option value="verified" ${it.status === 'verified' ? 'selected' : ''}>Verified âœ…</option>
                    </select>
                </td>
                <td><small>Created: ${it.created}</small>${it.lastEdit ? `<br><small style="color:blue">Edited: ${it.lastEdit}</small>` : ''}</td>
                <td>
                    <button class="action-btn" style="color:blue" onclick="viewReq(${it.id})">View</button>
                    ${session.role !== 'qa' ? `
                        <button class="action-btn" style="color:green" onclick="editReq(${it.id})">Edit</button>
                        <button class="action-btn" style="color:red" onclick="delReq(${it.id})">Del</button>
                    ` : ''}
                </td>
            `;
            body.appendChild(tr);
        });
    }

    function viewReq(id) {
        fillForm(id);
        const f = document.getElementById('qaFormMain');
        f.classList.add('read-only');
        f.querySelectorAll('input, select, textarea').forEach(i => i.disabled = true);
        document.getElementById('mainSubmitBtn').classList.add('hidden');
        document.getElementById('closeViewBtn').classList.remove('hidden');
        setTab('form');
    }

    function editReq(id) {
        fillForm(id);
        document.getElementById('editId').value = id;
        document.getElementById('mainSubmitBtn').innerText = "ðŸ’¾ Save Changes";
        setTab('form');
    }

    function fillForm(id) {
        const it = JSON.parse(localStorage.getItem('qa_db_main')).find(x => x.id == id);
        document.getElementById('ownerField').value = it.ownerName;
        document.getElementById('projName').value = it.project;
        document.getElementById('prioField').value = it.priority;
        document.getElementById('url_wtd').value = it.wtd;
        document.getElementById('url_stg').value = it.raw.urls[0];
        document.getElementById('url_live').value = it.raw.urls[1];
        document.getElementById('url_figma').value = it.raw.urls[2];
        document.getElementById('url_task_ref').value = it.raw.taskRef;
        document.getElementById('impactField').value = it.raw.impact;
        document.getElementById('scenarioField').value = it.raw.scenarios;
        document.getElementById('hrsField').value = it.raw.hours;
        
        // Restore BS
        document.getElementById('bs_ios').value = it.raw.bs[0];
        document.getElementById('bs_and').value = it.raw.bs[1];
        document.getElementById('bs_tab').value = it.raw.bs[2];
        document.getElementById('bs_ipad').value = it.raw.bs[3];
        document.getElementById('bs_mac').value = it.raw.bs[4];
        
        // Restore Checks
        document.querySelectorAll('.t-type').forEach(c => c.checked = it.raw.types.includes(c.value));
        document.querySelectorAll('.env-c').forEach(c => c.checked = it.raw.envs.includes(c.value));
        document.querySelector(`input[name="regR"][value="${it.raw.reg}"]`).checked = true;
    }

    function delReq(id) {
        if(!confirm("Delete this?")) return;
        let db = JSON.parse(localStorage.getItem('qa_db_main'));
        db = db.filter(x => x.id != id);
        localStorage.setItem('qa_db_main', JSON.stringify(db));
        renderTable();
    }

    init();
</script>
</body>
</html>
